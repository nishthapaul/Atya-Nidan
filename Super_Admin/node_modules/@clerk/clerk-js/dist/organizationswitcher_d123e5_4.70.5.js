"use strict";(globalThis.webpackChunk_clerk_clerk_js=globalThis.webpackChunk_clerk_clerk_js||[]).push([[336],{3617:function(e,t,i){i.r(t),i.d(t,{OrganizationSwitcher:function(){return _}});var n=i(2903),o=i(2784),r=i(5480),a=i(8173),s=i(3476),c=i(8690),l=i(8441),g=i(996),u=i(3244),d=i(4804),p=i(3736),m=i(9820),z=i(1609),h=i(1659);const v=e=>{const t=(0,c.useCardState)(),{userSuggestions:i}=(0,a.useCoreOrganizationList)({userSuggestions:h.AO.userSuggestions});return"accepted"===e.status?(0,n.tZ)(s.Text,{variant:"smallRegular",colorScheme:"neutral",localizationKey:(0,s.localizationKeys)("organizationSwitcher.suggestionsAcceptedLabel")}):(0,n.tZ)(s.Button,{elementDescriptor:s.descriptors.organizationSwitcherInvitationAcceptButton,textVariant:"buttonExtraSmallBold",variant:"outline",colorScheme:"neutral",size:"sm",isLoading:t.isLoading,onClick:()=>t.runAsync(e.accept).then((e=>{var t;return null===(t=null==i?void 0:i.setData)||void 0===t?void 0:t.call(i,(t=>(0,h.Sz)(e,t)))})).catch((e=>(0,z.S3)(e,[],t.setError))),localizationKey:(0,s.localizationKeys)("organizationSwitcher.action__suggestionsAccept")})},S=e=>{const t=(0,c.useCardState)(),{userInvitations:i}=(0,a.useCoreOrganizationList)({userInvitations:h.AO.userInvitations});return(0,n.tZ)(s.Button,{elementDescriptor:s.descriptors.organizationSwitcherInvitationAcceptButton,textVariant:"buttonExtraSmallBold",variant:"outline",colorScheme:"neutral",size:"sm",isLoading:t.isLoading,onClick:()=>t.runAsync(e.accept).then((e=>{var t;return null===(t=null==i?void 0:i.setData)||void 0===t?void 0:t.call(i,(t=>(0,h.$o)(e,t)))})).catch((e=>(0,z.S3)(e,[],t.setError))),localizationKey:(0,s.localizationKeys)("organizationSwitcher.action__invitationAccept")})},w=(0,c.withCardStateProvider)((e=>{const{children:t,publicOrganizationData:i}=e;return(0,n.BX)(s.Flex,{align:"center",gap:2,sx:e=>({minHeight:"unset",height:e.space.$12,justifyContent:"space-between",padding:`0 ${e.space.$6}`}),children:[(0,n.tZ)(c.OrganizationPreview,{elementId:"organizationSwitcher",avatarSx:e=>({margin:`0 calc(${e.space.$3}/2)`}),organization:i,size:"sm"}),t]})})),O=e=>{const{showBorder:t,...i}=e;return(0,n.tZ)(c.Actions,{sx:e=>({borderTop:t?`${e.borders.$normal} ${e.colors.$blackAlpha200}`:"none"}),role:"menu",...i})},C=()=>{var e,t;const{ref:i,userSuggestions:o,userInvitations:c}=(()=>{const{userInvitations:e,userSuggestions:t}=(0,a.useCoreOrganizationList)(h.AO),{ref:i}=(0,l.YD)({threshold:0,onChange:i=>{var n,o;i&&(e.hasNextPage?null===(n=e.fetchNext)||void 0===n||n.call(e):null===(o=t.fetchNext)||void 0===o||o.call(t))}});return{userInvitations:e,userSuggestions:t,ref:i}})(),g=c.isLoading||o.isLoading,u=c.hasNextPage||o.hasNextPage,d=!(!c.count&&!o.count);return(0,n.tZ)(O,{showBorder:d||g,elementDescriptor:s.descriptors.organizationSwitcherPopoverInvitationActions,children:(0,n.BX)(s.Box,{sx:e=>({maxHeight:`calc(4 * ${e.sizes.$12})`,overflowY:"auto",...m.common.unstyledScrollbar(e)}),children:[(c.count||0)>0&&(null===(e=c.data)||void 0===e?void 0:e.map((e=>(0,n.tZ)(w,{publicOrganizationData:e.publicOrganizationData,children:(0,n.tZ)(S,{...e})},e.id)))),(o.count||0)>0&&!c.hasNextPage&&(null===(t=o.data)||void 0===t?void 0:t.map((e=>(0,n.tZ)(w,{publicOrganizationData:e.publicOrganizationData,children:(0,n.tZ)(v,{...e})},e.id)))),(u||g)&&(0,n.tZ)(r.q7,{ref:i})]})})},P=e=>{const{onPersonalWorkspaceClick:t,onOrganizationClick:i}=e,{hidePersonal:o}=(0,a.useOrganizationSwitcherContext)(),{organization:r}=(0,a.useCoreOrganization)(),{organizationList:l}=(0,a.useCoreOrganizationList)(),g=(0,a.useCoreUser)(),u=(l||[]).map((e=>e.organization)).filter((e=>e.id!==(null==r?void 0:r.id))),{username:p,primaryEmailAddress:z,primaryPhoneNumber:h,...v}=g;return(0,n.BX)(s.Box,{sx:e=>({maxHeight:`calc(4 * ${e.sizes.$12})`,overflowY:"auto",...m.common.unstyledScrollbar(e)}),role:"group","aria-label":o?"List of all organization memberships":"List of all accounts",children:[r&&!o&&(0,n.tZ)(c.PreviewButton,{elementDescriptor:s.descriptors.organizationSwitcherPreviewButton,icon:d.oX,sx:{borderRadius:0},onClick:t,role:"menuitem",children:(0,n.tZ)(c.PersonalWorkspacePreview,{user:v,size:"sm",avatarSx:e=>({margin:`0 calc(${e.space.$3}/2)`}),title:(0,s.localizationKeys)("organizationSwitcher.personalWorkspace")})}),u.map((e=>(0,n.tZ)(c.PreviewButton,{elementDescriptor:s.descriptors.organizationSwitcherPreviewButton,icon:d.oX,sx:{borderRadius:0},onClick:()=>i(e),role:"menuitem",children:(0,n.tZ)(c.OrganizationPreview,{elementId:"organizationSwitcher",avatarSx:e=>({margin:`0 calc(${e.space.$3}/2)`}),organization:e,size:"sm"})},e.id)))]})},B=({onCreateOrganizationClick:e})=>(0,a.useCoreUser)().createOrganizationEnabled?(0,n.tZ)(c.Action,{elementDescriptor:s.descriptors.organizationSwitcherPopoverActionButton,elementId:s.descriptors.organizationSwitcherPopoverActionButton.setId("createOrganization"),iconBoxElementDescriptor:s.descriptors.organizationSwitcherPopoverActionButtonIconBox,iconBoxElementId:s.descriptors.organizationSwitcherPopoverActionButtonIconBox.setId("createOrganization"),iconElementDescriptor:s.descriptors.organizationSwitcherPopoverActionButtonIcon,iconElementId:s.descriptors.organizationSwitcherPopoverActionButtonIcon.setId("createOrganization"),textElementDescriptor:s.descriptors.organizationSwitcherPopoverActionButtonText,textElementId:s.descriptors.organizationSwitcherPopoverActionButtonText.setId("createOrganization"),icon:d.v3,label:(0,s.localizationKeys)("organizationSwitcher.action__createOrganization"),onClick:e}):null,f=e=>{const{onCreateOrganizationClick:t,onPersonalWorkspaceClick:i,onOrganizationClick:o}=e;return(0,n.BX)(n.HY,{children:[(0,n.tZ)(C,{}),(0,n.BX)(c.SecondaryActions,{elementDescriptor:s.descriptors.organizationSwitcherPopoverActions,role:"menu",children:[(0,n.tZ)(P,{onPersonalWorkspaceClick:i,onOrganizationClick:o}),(0,n.tZ)(B,{onCreateOrganizationClick:t})]})]})},x=o.forwardRef(((e,t)=>{const{close:i,...o}=e,r=(0,c.useCardState)(),{openOrganizationProfile:l,openCreateOrganization:m}=(0,a.useCoreClerk)(),{organization:z}=(0,a.useCoreOrganization)(),{isLoaded:h,setActive:v}=(0,a.useCoreOrganizationList)(),S=(0,p.useRouter)(),{hidePersonal:w,__unstable_manageBillingUrl:O,__unstable_manageBillingLabel:C,__unstable_manageBillingMembersLimit:P,createOrganizationMode:B,organizationProfileMode:x,afterLeaveOrganizationUrl:A,afterCreateOrganizationUrl:I,navigateCreateOrganization:k,navigateOrganizationProfile:_,navigateAfterSelectPersonal:Z,navigateAfterSelectOrganization:$,organizationProfileProps:y,skipInvitationScreen:D}=(0,a.useOrganizationSwitcherContext)(),L=(0,a.useCoreUser)(),{username:E,primaryEmailAddress:R,primaryPhoneNumber:K,...X}=L;if(!h)return null;const N=(0,n.tZ)(c.Action,{elementDescriptor:s.descriptors.organizationSwitcherPopoverActionButton,elementId:s.descriptors.organizationSwitcherPopoverActionButton.setId("manageOrganization"),iconBoxElementDescriptor:s.descriptors.organizationSwitcherPopoverActionButtonIconBox,iconBoxElementId:s.descriptors.organizationSwitcherPopoverActionButtonIconBox.setId("manageOrganization"),iconElementDescriptor:s.descriptors.organizationSwitcherPopoverActionButtonIcon,iconElementId:s.descriptors.organizationSwitcherPopoverActionButtonIcon.setId("manageOrganization"),textElementDescriptor:s.descriptors.organizationSwitcherPopoverActionButtonText,textElementId:s.descriptors.organizationSwitcherPopoverActionButtonText.setId("manageOrganization"),icon:d.tc,label:(0,s.localizationKeys)("organizationSwitcher.action__manageOrganization"),onClick:()=>(i(),"navigation"===x?_():l({...y,afterLeaveOrganizationUrl:A,__unstable_manageBillingUrl:O,__unstable_manageBillingLabel:C,__unstable_manageBillingMembersLimit:P})),trailing:(0,n.tZ)(b,{})}),U=(0,n.tZ)(c.Action,{icon:d.Nj,label:(0,g.OR)(C)||"Manage billing",onClick:()=>S.navigate((0,g.OR)(O))});return(0,n.tZ)(u.r,{elementDescriptor:s.descriptors.organizationSwitcherPopoverRootBox,children:(0,n.BX)(c.PopoverCard.Root,{elementDescriptor:s.descriptors.organizationSwitcherPopoverCard,ref:t,role:"dialog","aria-label":`${null==z?void 0:z.name} is active`,...o,children:[(0,n.BX)(c.PopoverCard.Main,{elementDescriptor:s.descriptors.organizationSwitcherPopoverMain,children:[z?(0,n.BX)(n.HY,{children:[(0,n.tZ)(c.OrganizationPreview,{elementId:"organizationSwitcher",gap:4,organization:z,user:L,fetchRoles:!0,sx:e=>t=>({padding:`0 ${e.space.$6}`,marginBottom:t.space.$2})}),(0,n.BX)(c.Actions,{role:"menu",children:[N,O&&U]})]}):!w&&(0,n.tZ)(c.PersonalWorkspacePreview,{gap:4,user:X,sx:e=>({padding:`0 ${e.space.$6}`,marginBottom:e.space.$6}),title:(0,s.localizationKeys)("organizationSwitcher.personalWorkspace")}),(0,n.tZ)(f,{onCreateOrganizationClick:()=>(i(),"navigation"===B?k():m({afterCreateOrganizationUrl:I,skipInvitationScreen:D})),onPersonalWorkspaceClick:()=>r.runAsync((()=>v({organization:null,beforeEmit:()=>Z(L)}))).then(i),onOrganizationClick:e=>r.runAsync((()=>v({organization:e,beforeEmit:()=>$(e)}))).then(i)})]}),(0,n.tZ)(c.PopoverCard.Footer,{elementDescriptor:s.descriptors.organizationSwitcherPopoverFooter})]})})})),b=(0,r.rh)((()=>{var e;const{organizationSettings:t}=(0,a.useEnvironment)(),i=null===(e=null==t?void 0:t.domains)||void 0===e?void 0:e.enabled,{membershipRequests:o}=(0,a.useCoreOrganization)({membershipRequests:i||void 0});return(0,n.tZ)(r.dN,{notificationCount:(null==o?void 0:o.count)||0})}),{permission:"org:sys_memberships:manage"}),A=(0,c.withAvatarShimmer)((0,o.forwardRef)(((e,t)=>{const{sx:i,...o}=e,{username:r,primaryEmailAddress:l,primaryPhoneNumber:g,...u}=(0,a.useCoreUser)(),{organization:p}=(0,a.useCoreOrganization)(),{hidePersonal:m}=(0,a.useOrganizationSwitcherContext)();return(0,n.BX)(s.Button,{elementDescriptor:s.descriptors.organizationSwitcherTrigger,variant:"ghost",colorScheme:"neutral",sx:[e=>({minHeight:0,padding:`0 ${e.space.$2} 0 0`,position:"relative"}),i],ref:t,"aria-label":(e.isOpen?"Close":"Open")+" organization switcher","aria-expanded":e.isOpen,"aria-haspopup":"dialog",...o,children:[p&&(0,n.tZ)(c.OrganizationPreview,{elementId:"organizationSwitcher",gap:3,size:"sm",fetchRoles:!0,organization:p,sx:{maxWidth:"30ch"}}),!p&&(0,n.tZ)(c.PersonalWorkspacePreview,{size:"sm",gap:3,user:u,showAvatar:!m,title:m?(0,s.localizationKeys)("organizationSwitcher.notSelected"):(0,s.localizationKeys)("organizationSwitcher.personalWorkspace")}),(0,n.tZ)(I,{}),(0,n.tZ)(s.Icon,{elementDescriptor:s.descriptors.organizationSwitcherTriggerIcon,icon:d.Qf,sx:e=>({opacity:e.opacity.$sm,marginLeft:`${e.space.$2}`})})]})}))),I=()=>{var e;const{userInvitations:t,userSuggestions:i}=(0,a.useCoreOrganizationList)(h.AO),{organizationSettings:o}=(0,a.useEnvironment)(),{isAuthorizedUser:s}=(0,r.DD)({permission:"org:sys_memberships:manage"}),c=null===(e=null==o?void 0:o.domains)||void 0===e?void 0:e.enabled,{membershipRequests:l}=(0,a.useCoreOrganization)({membershipRequests:c&&s||void 0}),g=(t.count||0)+(i.count||0)+((null==l?void 0:l.count)||0);return(0,n.tZ)(r.dN,{containerSx:e=>({marginLeft:`${e.space.$2}`}),notificationCount:g})},k=(0,c.withFloatingTree)((()=>{const{floating:e,reference:t,styles:i,toggle:r,isOpen:a,nodeId:g,context:u}=(0,l.Sv)({placement:"bottom-start",offset:8}),d=(0,o.useId)();return(0,n.BX)(s.Flow.Root,{flow:"organizationSwitcher",children:[(0,n.tZ)(A,{ref:t,onClick:r,isOpen:a,"aria-controls":d}),(0,n.tZ)(c.Popover,{nodeId:g,context:u,isOpen:a,children:(0,n.tZ)(x,{id:d,close:r,ref:e,style:{...i}})})]})})),_=(0,r.pK)((0,a.withCoreUserGuard)((0,c.withCardStateProvider)(k)),"OrganizationSwitcher",{mode:"hide"})},1659:function(e,t,i){i.d(t,{$o:function(){return r},AO:function(){return n},Sz:function(){return o}});const n={userMemberships:{infinite:!0},userInvitations:{infinite:!0},userSuggestions:{infinite:!0,status:["pending","accepted"]}},o=(e,t)=>void 0===t?[{data:[e],total_count:1}]:t.map((t=>{if(void 0===t)return t;const i=t.data.map((t=>t.id===e.id?{...e}:t));return{...t,data:i}})),r=(e,t)=>{var i;const n=null===(i=null==t?void 0:t[t.length-1])||void 0===i?void 0:i.total_count;if(n)return null==t?void 0:t.map((t=>{if(void 0===t)return t;const i=t.data.filter((t=>t.id!==e.id));return{...t,data:i,total_count:n-1}}))}}}]);